limit_conn_zone $binary_remote_addr zone=perip:10m;

server {
    listen 80;
    server_name _;

    location / {
        return 200 'Nginx target is up\n';
        add_header Content-Type text/plain;
    }

    location /stub_status {
        stub_status;
        allow all;
        access_log off;
    }

    # Slowloris defensive settings
    client_header_timeout 10s;
    client_body_timeout 10s;
    keepalive_timeout 15s;
    send_timeout 10s;

    # Basic per-IP connection limiting (defense only)
    limit_conn perip 30;
}
